import{p as B,r as c,j as e,T as N,u as E,a as T,B as g,f as I,l as S,m as k,b as L,n as $,S as z}from"./index-DAWEFctM.js";const K="_input_byhn5_1",R={input:K},d=({className:t,...l})=>{const o=c.useMemo(()=>`${R.input} ${t??""}`,[t]);return e.jsx("input",{className:o,...l})};d.propTypes={className:B.PropTypes.string};const V="_textarea_6irl5_1",H="_form_6irl5_29",w={textarea:V,form:H},f=c.createContext(null),q=()=>{const{formData:t,setFormData:l}=c.useContext(f),o=p=>{const{name:h,value:m}=p.target;l({...t,[h]:m})};return e.jsxs("form",{className:w.form,children:[e.jsx(N,{type:"h2",children:" Faktureringsoplysninger "}),e.jsx(d,{placeholder:"Fornavn",name:"firstname",type:"text",onChange:o,value:t.firstname}),e.jsx(d,{placeholder:"Efternavn",name:"secondname",type:"text",onChange:o,value:t.secondname}),e.jsx(d,{placeholder:"Land",name:"country",type:"text",onChange:o,value:t.country}),e.jsx(d,{placeholder:"By",name:"city",type:"text",onChange:o,value:t.city}),e.jsx(d,{placeholder:"Postnummer",name:"zip",type:"text",onChange:o,value:t.zip}),e.jsx(d,{placeholder:"Address",name:"adress",type:"text",onChange:o,value:t.adress}),e.jsx(d,{placeholder:"Email",name:"email",type:"email",onChange:o,value:t.email}),e.jsx(d,{placeholder:"Telefon",name:"phone",type:"text",onChange:o,value:t.phone}),e.jsx("textarea",{className:w.textarea,placeholder:"Kommentar",name:"comment",onChange:o,value:t.comment})]})},G="_container_18c1y_1",J="_table_18c1y_17",Q="_row_18c1y_25",U="_orderTitle_18c1y_43",W="_orderContainer_18c1y_53",X="_total_18c1y_61",Y="_amount_18c1y_67",Z="_price_18c1y_69",ee="_img_18c1y_77",se="_button_18c1y_87",te="_loader_18c1y_139",ae="_closeButton_18c1y_153",re="_dialog_18c1y_195",ne="_description_18c1y_217",oe="_errorMessage_18c1y_225",s={container:G,table:J,row:Q,orderTitle:U,orderContainer:W,total:X,amount:Y,price:Z,img:ee,button:se,loader:te,closeButton:ae,dialog:re,description:ne,errorMessage:oe},ce=()=>{const t=E(L),[l,o]=T("productsData",{}),[p,h]=T("ordersId",[]),[m,O]=c.useState([]),{formData:b}=c.useContext(f),[j,v]=c.useState(!1),[_,P]=c.useState(""),x=c.useRef(null),[C,D]=c.useState(""),y=c.useMemo(()=>m==null?void 0:m.map(r=>r==null?void 0:r.products.map(a=>({...t.data.find(i=>i._id===a.id),...a}))),[t.data,m]),M=async()=>{const r=p.map(async i=>await $(i)),n=(await Promise.all(r)).map(i=>i[0]);O(n)},F=async()=>{if(Object.values(b).every(a=>typeof a=="string"&&a!=="")){D(""),v(!0);try{const a={email:b.email,products:l.products},n=await k(a);h([...p,n._id]),o(n),M()}catch(a){P(a.message),console.error(a)}finally{x.current.showModal(),v(!1),o({...l,products:[]})}}else D("Du skal udfylde alle felter")},u=c.useMemo(()=>{var a;const r=(a=l.products)==null?void 0:a.reduce((n,i)=>(n[i.id]=i.amount,n),{});return t.data.filter(n=>l.products&&l.products.map(i=>i.id).includes(n._id)).map(n=>({...n,amount:r[n._id]||1}))},[t.data,l]),A=c.useMemo(()=>u.reduce((r,a)=>r+a.price*a.amount,0),[u]);return e.jsxs("article",{className:s.container,children:[u.length<=0&&e.jsx("p",{children:"Din ordre er tom"}),u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(N,{type:"h2",children:"Din ordre"}),e.jsxs("div",{className:s.table,children:[e.jsxs("div",{className:s.row,children:[e.jsx("b",{children:"Vare"}),e.jsx("b",{children:"Title"}),e.jsx("b",{children:"Description"}),e.jsx("b",{className:s.amount,children:"Antal"}),e.jsx("b",{className:s.price,children:"Subtotal"})]}),u.map(r=>e.jsxs("div",{className:s.row,children:[e.jsx("img",{src:r.image,className:s.img,alt:""}),e.jsx("b",{children:r.title}),e.jsxs("span",{children:[" ",r.description," "]}),e.jsx("span",{className:s.amount,children:r.amount}),e.jsx("span",{className:s.price,children:r.price})]},r._id)),e.jsxs("div",{className:s.row,children:[e.jsx("b",{className:s.total,children:"Total"}),e.jsx("span",{className:s.price,children:A})]})]}),e.jsxs(g,{type:"button",onClick:F,className:s.button,disabled:j,children:["Betal",j&&e.jsx(I,{className:s.loader})]}),C&&e.jsx("span",{className:s.errorMessage,children:C})]}),e.jsxs("dialog",{className:s.dialog,ref:x,children:[_&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:s.description,children:_}),e.jsx(g,{onClick:()=>x.current.close(),className:s.closeButton,type:"button",children:e.jsx(S,{})})]}),!_&&!j&&e.jsxs(e.Fragment,{children:[e.jsx(N,{className:s.orderTitle,type:"h2",children:"Tak for din bestiling"}),e.jsx("p",{className:s.description,children:"Din ordre er nu sendt til din e-mail."}),e.jsx("b",{className:s.orderTitle,children:"Tildigere ordre"}),y&&y.length>0&&y.map((r,a)=>e.jsxs("div",{className:s.orderContainer,children:[e.jsxs("b",{className:s.orderTitle,children:["Ordre ",a+1]}),e.jsxs("div",{className:s.row,children:[e.jsx("b",{children:"Image"}),e.jsx("b",{children:"Title"}),e.jsx("b",{children:"Description"}),e.jsx("b",{className:s.amount,children:"Antal"}),e.jsx("b",{className:s.price,children:"Price"})]}),r.map((n,i)=>e.jsxs("div",{className:s.row,children:[e.jsx("img",{src:n.image,className:s.img,alt:""}),e.jsx("b",{children:n.title}),e.jsx("span",{children:n.description}),e.jsx("span",{className:s.amount,children:n.amount}),e.jsx("span",{className:s.price,children:n.price})]},i))]},a)),e.jsx(g,{onClick:()=>x.current.close(),className:s.closeButton,type:"button",children:e.jsx(S,{})})]})]})]})},le="_container_2g0gn_1",ie={container:le},me=()=>{const t={firstname:"",secondname:"",country:"",city:"",zip:"",adress:"",email:"",phone:"",comment:""},[l,o]=c.useState(t);return e.jsx(z,{classNameContainer:ie.container,children:e.jsxs(f.Provider,{value:{formData:l,setFormData:o},children:[e.jsx(q,{}),e.jsx(ce,{})]})})};export{me as default};
